<!DOCTYPE html>
<meta charset="utf-8">
<title>OpenAdm</title>
  

<div id="body">
  <div id="charts" style="height:400px">
  <div class='pie-graph span4' id='dc-line-chart' >
  </div>
</div>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="echarts-all.js"></script>
<script>
function parseDate(d) {
  return new Date(d*1000);
}
$(document).ready(function() {
  $.ajax({
    type:'get',
    url:'https://raw.githubusercontent.com/CliffLin/dlinknctu/master/openadm/traffic.json',    
 　　dataType:'text',
 　　success:function(msg){  
      var trafficObj=JSON.parse(msg);   
      var myChart = echarts.init(document.getElementById('charts'));  
      for(i=0;i<trafficObj.length;i++)
      {
        trafficObj[i]["bucket"] = parseDate(trafficObj[i]["bucket"]);
      }
      $.ajax({
        type:'get',  
        url:'https://raw.githubusercontent.com/CliffLin/dlinknctu/master/openadm/clone.json',    
        dataType:'text', 
        success:function(msg){  
          var cloneObj=JSON.parse(msg);   
          for(i=0;i<cloneObj.length;i++)
          {
            cloneObj[i]["bucket"] = parseDate(cloneObj[i]["bucket"]);
          }
          setoptiondata(trafficObj,cloneObj,myChart);
        }
      });
 　  },
    error:function(){
      alert('error');  
    }  
  })
});
  var url_traffic = "https://raw.githubusercontent.com/CliffLin/dlinknctu/master/openadm/traffic.json";
  var url_clone =  "https://raw.githubusercontent.com/CliffLin/dlinknctu/master/openadm/clone.json";
  function setoptiondata(jsonTrafficData,jsonCloneData,myChart) {
    option = {
    tooltip : {
        trigger: 'axis'
    },
    legend: {
        data:['Visitor','Clone']
    },
    toolbox: {
        show : false,
        feature : {
            mark : {show: true},
            dataZoom : {show: true},
            dataView : {show: true},
            magicType : {show: true, type: ['line', 'bar', 'stack', 'tiled']},
            restore : {show: true},
            saveAsImage : {show: true}
        }
    },
    calculable : true,
    dataZoom : {
        show : true,
        realtime : true,
        start : 20,
        end : 80
    },
    xAxis : [
        {
            type : 'category',
            boundaryGap : false,
            data : function (){
                var list = [];
                for (i = 0; i < jsonTrafficData.length; i++) {
                    d = jsonTrafficData[i]["bucket"];
                    list.push(d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate());
                }
                return list;
            }()
        }
    ],
    yAxis : [
        {
            type : 'value',
            position: 'left',
            name:'Visitor'
        },
        {
            type : 'value',
            position: 'right',
            name:'Clone'
        }
    ],
    series : [
        {
            name:'Visitor',
            type:'line',
            data:function (){
                var list = [];
                temp = 0;                
                for (i = 0; i < jsonTrafficData.length; i++) {
                    d = temp + jsonTrafficData[i]["total"];
                    temp = d;
                    list.push(d);
                }
                return list;
            }()
        },
        {
            name:'Clone',
            type:'line',
            yAxisIndex: 1,
            data:function (){
                var list = [];
                temp = 0;
                for (i = 0; i < jsonCloneData.length; i++) {
                    d = temp + jsonCloneData[i]["total"];
                    temp = d ;
                    list.push(d);
                }
                return list;
            }()
        }
    ]
};
    myChart.setOption(option);                 
  }              

</script>
